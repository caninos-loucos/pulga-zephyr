# SPDX-License-Identifier: Apache-2.0
cmake_minimum_required(VERSION 3.13.3)

set(L86_M33_ZCBOR_DIR ${CMAKE_CURRENT_SOURCE_DIR}/zcbor)

# The zcbor-generated files can be regenerated by calling this file with -DREGENERATE_ZCBOR=Y
# This will call zcbor to regenerate the files, and then build like usual.
if (REGENERATE_ZCBOR)
  set (zcbor_command
    zcbor code --encode --short-names 
    -c ${L86_M33_ZCBOR_DIR}/l86_m33.cddl 
    -t ZcborPayloadL86_M33 
    --output-cmake ${L86_M33_ZCBOR_DIR}/l86_m33.cmake 
    --output-h ${L86_M33_ZCBOR_DIR}/l86_m33_encode.h 
    --output-c ${L86_M33_ZCBOR_DIR}/l86_m33_encode.c
  )
  execute_process(COMMAND ${zcbor_command})
endif()

# Include the cmake file generated by the regenerate_zcbor.sh file. It adds the
# generated code and the necessary zcbor C code files.
include(${L86_M33_ZCBOR_DIR}/l86_m33.cmake)

# Link the library from l86_m33.cmake
target_link_libraries(app PRIVATE l86_m33)

# Add the directory containing l86_m33.h
target_include_directories(app PRIVATE ${L86_M33_ZCBOR_DIR})

target_sources(app PRIVATE zcbor/l86_m33_encode.c)
