# SPDX-License-Identifier: Apache-2.0
cmake_minimum_required(VERSION 3.13.3)

set(BME280_ZCBOR_DIR ${CMAKE_CURRENT_SOURCE_DIR}/src/sensors/bme280/zcbor)

# The zcbor-generated files can be regenerated by calling this file with -DREGENERATE_ZCBOR=Y
# This will call zcbor to regenerate the files, and then build like usual.
if (REGENERATE_ZCBOR)
  set (zcbor_command
    zcbor code --encode --short-names 
    -c ${BME280_ZCBOR_DIR}/bme280.cddl 
    -t ZcborPayloadBME280 
    --output-cmake ${BME280_ZCBOR_DIR}/bme280.cmake 
    --output-h ${BME280_ZCBOR_DIR}/bme280_encode.h 
    --output-c ${BME280_ZCBOR_DIR}/bme280_encode.c
  )
  execute_process(COMMAND ${zcbor_command})
endif()

# Include the cmake file generated by the regenerate_zcbor.sh file. It adds the
# generated code and the necessary zcbor C code files.
include(${BME280_ZCBOR_DIR}/bme280.cmake)

# Link the library from bme280.cmake
target_link_libraries(app PRIVATE bme280)

# Add the directory containing bme280.h
target_include_directories(app PRIVATE ${BME280_ZCBOR_DIR})